# Specification Document: ox (Oxide)

`ox` は、Rustで構築された、高速かつ軽量で、直感的な操作性を追求したクロスプラットフォーム（Windows/macOS）対応のCLIファイルマネージャーです。

## 1. デザインコンセプト

* Efficiency (効率): 最小限のキー入力で目的のファイルに到達する。
* Responsiveness (応答性): 大規模なディレクトリでもUIをフリーズさせない。
* Modern Integration (現代的な融合): CLIでありながら、OSのクリップボードやドラッグ＆ドロップ(D&D)と親和性を持たせる。

## 2. 画面構成 (UI Layout)

### 2.1 Top Bar

* Current Path: 現在のディレクトリのフルパスを表示（OS標準の区切り文字を使用）。
* Active Item: 右端に現在カーソルが当たっているアイテム名を表示。

### 2.2 Main View (Dual Pane)

* Left Pane (Parent): 現在のディレクトリの「1つ上の階層」を一覧表示。文脈の把握を助ける。
* Center Pane (Active): 現在のディレクトリのファイル/フォルダ一覧。操作のメイン画面。

### 2.3 Bottom Bar

* Metadata: 選択中アイテムの容量、最終更新日時。
* Git Status: 右端に現在のGitブランチ名を表示（非同期取得）。
* Search Prompt: インクリメンタル検索アクティブ時にクエリを表示。

### 2.4 Tabs

* 画面上部（またはTop Bar直下）に複数のタブを表示。異なるパスを並行して管理可能。

---

## 3. 機能仕様 (Core Features)

### 3.1 階層移動 (A-style Navigation)

* Alt (or Cmd) + ←: 親ディレクトリへ移動。
* Alt (or Cmd) + →: 選択中のディレクトリへ入る。
* Enter / Click: ディレクトリなら入る。ファイルならOS標準のアプリで開く。

### 3.2 検索とフィルタリング

* Incremental Search (v1): - 文字入力により、一致するファイルへ即座にカーソルがジャンプ。
* `ESC` キーで検索クエリをクリア。


* Hidden Files: - デフォルトは非表示。
* `Ctrl + H` で表示/非表示をトグル切り替え。



### 3.3 ファイル操作

* Copy & Paste: - `Ctrl + C / V` によるOSクリップボード連携。アプリ外からのパス貼り付けにも対応。
* Drag & Drop: - ターミナルへのファイルドロップ（パス文字列の入力）を検知し、現在地へコピーを実行。
* Sorting: - デフォルト：日付順（フォルダ優先）。
* 設定により、名前順、サイズ順への切り替えをサポート。



### 3.4 セッション管理

* Persistence: 終了時のタブ状態（パス）を保存し、次回起動時に復元。
* New Session: `--new` フラグ付きで起動した場合は保存を無視し、`$HOME` から開始。

---

## 4. アーキテクチャ設計

### 4.1 Core / UI 分離

* Core Thread (Backend):
* `notify` クレートによるファイルシステム監視。
* メタデータ（サイズ、Git情報）の非同期取得。
* イベントの Throttling (流量制限): 設定ファイルで指定された間隔（例: 100ms）でUIへ状態をプッシュ。

* UI Thread (Frontend):
* `ratatui` による描画。
* キー/マウスイベントのハンドリング。

### 4.2 パフォーマンス最適化

* Lazy Loading: 初回スキャンはファイル名のみ取得し、表示領域のメタデータのみ後追いで取得。
* Scanning: 隠しファイルはスキャン段階でフィルタリングし、メモリ負荷を軽減。
* Connectivity: セッション復元時にアクセス不能なパスがある場合、ブロッキングせず「接続中...」等のプレースホルダーを表示。

---

## 5. 設定 (Configuration)

`config.toml` (またはOS標準の設定ディレクトリ) にて以下の項目を管理。

* `update_interval`: FS監視のバッファ時間 (ms)
* `default_sort`: 初期ソート順
* `show_git`: Git連携の有効/無効
* `session_restore`: セッション復元の有効/無効

---

## 6. ロードマップ

### v1 (MVP)

* 基本ナビゲーション、インクリメンタル検索、D&Dコピー、セッション復元、OS連携クリップボード。

### v2 (Future)

* プレビューペイン（ファイル内容のチラ見せ）、一括選択（マーク）機能、Path Barのクリック移動、ウィンドウ分割比率の動的調整。

# ox (Oxide) 開発バックログ

## Phase 1: 基本的な閲覧とナビゲーション (Walking Skeleton)

Goal: ファイルマネージャーとして最低限「歩ける」状態を目指します。

* [x] 1.1 基本レイアウトとディレクトリ一覧の表示
  * [x] `ratatui` を使用し、メインペインに現在のディレクトリの内容（ファイル名のみ）を表示する。
  * [x] 起動時にカレントディレクトリを表示し、`Ctrl + Q` で終了できる。
  * [x] Value: アプリを起動して中身が見える。
* [x] 1.2 基本的な階層移動 (A-style)
  * [x] `Enter` で選択項目を開く（フォルダなら移動、ファイルなら実行）
  * [x] `→` / `]` でフォルダに入り、`←` / `[` で親に戻る。
  * [x] 常に「1つ上の階層」を左ペインに表示する。
  * [x] Value: フォルダツリーを自由に移動できる。
* [x] 1.3 隠しファイルのフィルタリングとトグル
  * [x] デフォルトで隠しフォルダを除外してスキャンする。
  * [x] `Ctrl + H` を押した瞬間に表示が切り替わる。
  * [x] Value: 視覚的なノイズを減らし、必要な時だけ詳細を見れる。

## Phase 2: 操作性と検索の強化

Goal: 日常的なツールとしての利便性を向上させます。

* [x] 2.1 インクリメンタル検索の実装
  * [x] 文字を入力すると、その文字で始まるファイルにカーソルが即座に飛ぶ。
  * [x] `ESC` で検索状態がリセットされ、元の位置に戻る（または検索が解かれる）。
  * [x] Value: 大量のファイルから目的のものを数打で探せる。
* [x] 2.2 ファイルのメタデータ表示
  * [x] ボトムバーに選択アイテムのサイズと更新日時を表示する。
  * [x] Value: 他のアプリを介さず「探す」が完結する。
* [x] 2.3 Gitブランチ名の非同期表示
  * [x] Core層で非同期にGit情報を取得し、取得完了後にボトムバーへ反映する。
  * [x] Value: 開発者が現在の作業コンテキストを即座に把握できる。

## Phase 3: 高度なファイル操作と外部連携

Goal: OSとの親和性を高め、実用性を完成させます。

* [ ] 3.1 ドラッグ＆ドロップによるコピー
  * [ ] ターミナルへのパスドロップ入力をパースし、ファイルコピー処理をバックグラウンドで開始する。
  * [ ] コピー中の進捗をUIに表示する。
  * [ ] Value: GUIからCLIへのスムーズなファイル受け渡し。

## Phase 4: セッションとパフォーマンスの最適化

Goal: 「プロの道具」としての堅牢性を高めます。

* [x] 4.1 タブ管理機能
  * [x] `Ctrl + T` で新しいタブを作成し、それぞれ独立したパスを保持・切り替えできる。
  * [x] Value: 複数の場所を跨いだ作業の効率化。
* [ ] 4.2 セッションの永続化と復元
  * [ ] 終了時に現在のタブ/パスを保存し、再起動時に復元する。
  * [ ] Value: アプリを閉じる前の状態から即座に再開できる。
* [ ] 4.3 リアルタイムFS監視とスロットリング
  * [ ] `notify` を導入し、外部のファイル変更を自動でUIに反映する。
  * [ ] 設定ファイルから更新間隔を制御できるようにする。
  * [ ] Value: 常に最新のファイルシステム状態を、低負荷で維持できる。

## features

- [x] txt, md 等一部形式ファイルのファイルプレビューの表示
- [ ] プレビューでのシンタックスハイライト表示 `syntect`
- [ ] headless 環境向けに opener を無効化できる設定を追加する
- [x] フォルダを `<-` で戻ったとき、子フォルダをフォーカスできる
- [ ] つい `Ctrl + C` でアプリを終わらせたくなるので、 `Ctrl + C` を ２回押したら終われるようにする。１回目は警告・一定時間以内 `3sec以内` に２回目が押されたら、ほんとに終了
- [ ] `/` から始まるコマンド
  - [ ] `/cwd /path/to`: Path IntelliSence 付きの、`cd` 機能
- [ ] `/shell {command}`: working directory 内で default shell でコマンド実行(PowerShell/Shell)
  - TODO: AllowedShell 機構は別途検討し、将来的に特定シェルを明示的に選べるようにする。
  - TODO: AllowedShell 機構は別途検討し、将来的に特定シェルを明示的に選べるようにする。
  - 既知事項: Windows の UNC パス (`\\server\share` / `\\?\UNC\server\share`) の比較が未対応。  
     
    共有フォルダを使う環境では `PathEscapesWorkingDir` の誤検知が起きる可能性がある。
  - [ ] `/help`: ヘルプドキュメントの閲覧
  - [ ] `/clip`: クリップボードにファイルをコピーする
  - [ ] `/clip`: クリップボードにパスをコピーする
  - [ ] `/tab close`: 現在のタブをクローズする。番号入力で指定インデックスのタブをクローズ
  - [ ] `/quit`: 閲覧を終了する（アプリの終了）
  - [ ] `/tab new /path/to`: /path/to で受け取ったパスを開く。Path Intellisence付き。
- [ ] ハイライト色の設定
  - [ ] ハイライト色を設定で変更できるようにする。
  - [ ] Value: 見やすさを好みに合わせて調整できる。
- [ ] 3.1 クリップボードを介したコピペ (Ctrl+C/V)
  - [ ] `Ctrl + C` or `Cmd + C` でパスをクリップボードへ保存。
  - [ ] `Ctrl + V` or `Cmd + V` でクリップボード内のパス（外部からのドロップ含む）を現在地にコピー。
  - [ ] Value: OS標準の操作と一貫性のあるファイル管理ができる。
- [ ] ファイルメタデータ取得のリフレッシュレート向上、先行読み込み等を駆使したユーザー体験の向上
- [ ] セッション復元時、ネットワークドライブ等で遅延がある場合「接続中...」と表示しUIを固めない。
- [x] タブごとにカラーテーマを設定できるようにする
  - [x] base, primary(選択・フォーカス), secondary(補助), semantic(success/warn/error/info), grayscaleなどの状態と、タブの色調とは分けて整理する。タブの彩度は、メインのボーダーカラーとして使われるので、はっきり見えつつsemantic・primary/secondaryを邪魔しない色調にする = 低〜中彩度・中明度の「寒色寄りニュートラル」で、最低5つのテーマを用意し、タブにアサインできるようにする
  - [ ] アサインするコマンドは `/color {theme name}` で、テーマ名のサジェストを入れる
- [ ] デザインのブラッシュアップ、画面表示内容の再構成検討
- [ ] ファイルナビゲーション内でのページアップ・ダウン、Home/End
